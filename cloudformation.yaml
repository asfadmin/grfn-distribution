AWSTemplateFormatVersion: 2010-09-09

Parameters:

  PrivateBucket:
    Description: Name of S3 bucket in which zipped output products will be archived
    Type: String

  LogBucket:
    Type: String

  CertificateArn:
    Type: String

  DomainName:
    Type: String

  CloudFrontKeyPairId:
    Type: String

  PrivateKeySecretName:
    Type: String

  AuthUrl:
    Type: String

  JwtCookieName:
    Type: String

  JwtPublicKey:
    Type: String
    Default: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDBU3T16Db/88XQ2MTHgm9uFALjSJAMSejmVL+tO0ILzHw2OosKlVb38urmIGQ+xMPXTs1AQQYpJ/CdO7TaJ51pv4iz+zF0DYeUhPczsBEQYisLMZUwedPm9QLoKu8dkt4EzMiatQimBmzDvxxRkAIDehYh468phR6zPqIDizbgAjD4qgTd+oSA9mDPBZ/oG1sVc7TcoP93FbO9u1frzhjf0LS1H7YReVP4XsUTpCN0FsxDAMfLpOYZylChkFQeay7n9CIK8em4W4JL/T0PC218jXpF7W2p92rfAQztiWlFJc66tt45SXAVtD1rMEdWGlzze4acjMn4P7mugHHb17igtlF82H/wpdm84qTPShvBp/F4YZejgAzOAxzKVbCQ8lrApk1XYVDRAVk3AphfvNK5IC/X9zDSXstH9U94z8BTjkL2fR4eKzFu5kkvVoGHAACIv72QvH06Vwd0PNzLyaNXr9D5jO61EbR4RfpbzvAG0IzgXsUq0Rj7qwvzTCu6yLwTi/fn9bmRaOQNPtBch4ai5w7cfUWe2r7ZPv31AXPm1A+aGXvYTEZkiQMrBN/dXlNdUmafNNDoMBm/frQhMl+2DZp+C9GXCr2Z/JmYUHO8PaEj6UyYTkkrmtZNlZ43Nd2TblPEzL0pprJM9MxEf2Peaai8GKmTJz6C5tSGU+XdZQ== root@9dce6b43747e

Resources:

  DoorStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        Name: !Sub "${AWS::StackName}-door"
        CloudFrontDomainName: !GetAtt CloudFrontStack.Outputs.DomainName
        CloudFrontKeyPairId: !Ref CloudFrontKeyPairId
        PrivateKeySecretName: !Ref PrivateKeySecretName
        PrivateBucket: !Ref PrivateBucket
        CertificateArn: !Ref CertificateArn
        DomainName: !Ref DomainName
        AuthUrl: !Ref AuthUrl
        JwtCookieName: !Ref JwtCookieName
        JwtPublicKey: !Ref JwtPublicKey
      TemplateURL: door/cloudformation.yaml

  CloudFrontStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      Parameters:
        Name: !Ref AWS::StackName
        Bucket: !Ref PrivateBucket
        LogBucket: !Ref LogBucket
      TemplateURL: cloudfront/cloudformation.yaml
